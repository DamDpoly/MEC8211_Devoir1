%{ 
Ce code permet la résolution de l'équation de diffusion du sel suivant
un modèle stationnaire. 
La discrétisation spatial du pilier est gérable avec le paramètre Ntot,
qualifiant le nombre total de noeuds du système, par défault il est de 5.
Les paramètres liés aux dimensions du pilier et aux concentrations de sels 
sont constants.
%}


clc

% Definition des constantes de l'exercice
Deff = 10^(-10);  
S = 2*10^(-8);
Ce = 20; 
D = 1; 
Rayon = D /2;
alpha = S / Deff;

% Definition du nombre de noeuds de discrétisation
Ntot = 5;

% Calcul du pas de discrétisation dr
dr = Rayon / (Ntot - 1);

%Definition des matrices A et B pour pouvoir calculer A C = B

A = zeros(Ntot-2,Ntot-2);

B = zeros(Ntot-2,1);

disp(A);

disp(B);
    

%Remplissage de A

for i = 1:Ntot-2

    if i == 1 % Nécéssité d'une condition If pour séparer le cas global de la condition limite C1 = C0
        A(i, 1) = i -(2*i+1); % Coefficient pour C_i-1
        
    else 
        A(i,i-1) = i;
        
        A(i, i) = - (2*i + 1); % Coefficient pour C_i
        
    end
    
    if i < Ntot-2 % Nécéssité d'une condition If pour séparer le cas global de la condition C_N-1 = CE où le terme en C_i+1 est absent de la matrice A car envoyé dans le second membre B 
        A(i, i+1) = i + 1; % Coefficient pour C_i+1
        
    end
    
end

disp(A);


%Remplissage de B

for i=1:Ntot-2
B(i,1)= alpha * dr * dr * (i); % Cas global 

if i==Ntot-2
B(i,1)= alpha * dr * dr * (i)-(Ntot-1)*Ce; % Cas pour le dernier terme de la matrice affecté par la condition C_N-1 = CE

end

end

disp(B);

C = A\B; 

C = [C(1); C; Ce];

disp(C);


% Définition de la position de chaque noeuds dans le vecteur r
r = linspace(0, Rayon, Ntot);

% Calcul de la concentration avec la solution analytique
C_analytic = (1/4) * (alpha) * Rayon^(2) * ((r.^(2) / Rayon^(2)) - 1) + Ce;

disp(C_analytic);

% Tracer de la comparaison des concentrations analytiques et numériques
figure;
plot(r, C, '-o', 'DisplayName', 'Résultat Numérique');
hold on;
plot(r, C_analytic, '-x', 'DisplayName', 'Résultat Analytique');
xlabel('Rayon r (m)');
ylabel('Concentration C (mol/m^3)');
title('Comparaison entre les résultats numériques et analytiques');
legend('show');
grid on;




